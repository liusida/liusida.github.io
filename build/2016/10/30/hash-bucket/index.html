<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8"> <title>About sparse_column_with_hash_bucket</title> <meta http-equip="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content="About sparse_column_with_hash_bucket" /> <meta name="keywords" content="About sparse_column_with_hash_bucket, Sida Liu, " /> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"> <meta content="" property="fb:app_id"> <meta content="Sida Liu" property="og:site_name"> <meta content="About sparse_column_with_hash_bucket" property="og:title"> <meta content="article" property="og:type"> <meta content="The world is so complex that we cannot stop learning." property="og:description"> <meta content="https://liusida.github.io/2016/10/30/hash-bucket/" property="og:url"> <meta content="2016-10-30T00:00:00+08:00" property="article:published_time"> <meta content="https://liusida.github.io/about/" property="article:author"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@"> <meta name="twitter:title" content="About sparse_column_with_hash_bucket"> <meta content="Sida Liu" property="og:site_name"> <meta name="twitter:url" content="https://liusida.github.io/2016/10/30/hash-bucket/"> <meta name="twitter:description" content="The world is so complex that we cannot stop learning."> <link rel="stylesheet" href="/assets/css/main.css" /> <!-- <link rel="stylesheet" href="/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="/assets/bower_components/lightgallery/dist/css/lightgallery.min.css"/> <!-- <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css" /> --> <!-- <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css"> --> <!-- <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css"> --> <link rel="stylesheet" href="/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="/assets/bower_components/icono/dist/icono.min.css"/> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet"> <!-- Favicon --> <link rel="icon" href="https://liusida.github.io/assets/img/favicon.ico" type="image/gif" sizes="16x16"> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous"></script> <!-- <script src="/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <!-- <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script> --> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script> </head><body> <nav class="navbar navbar-expand-lg fixed-top navbar-dark" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/">Sida Liu</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="https://liusida.github.io/cover" >Cover</a > </li> <li class="nav-item"> <a class="nav-link" href="https://liusida.github.io/blog" >Blog</a > </li> <li class="nav-item"> <a class="nav-link" href="https://liusida.github.io/contact" >Contact Me</a > </li> </ul> </div> <ul class="nav justify-content-end"> <!-- <li class="nav-item"> <a class="nav-link" id="search-icon" href="https://liusida.github.io/search#/" ><i class="fa fa-search" aria-hidden="true"></i ></a> </li> <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() " type="checkbox" name="checkbox" /> </li> --> </ul> </nav> <div class="col-lg-12"> <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script> <div class="row" id="blog-post-container"> <div class="col-lg-8 offset-md-2"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">About sparse_column_with_hash_bucket</h1> <h4 class="post-meta"></h4> <p class="post-summary"> Posted by : (<time datetime="2016-10-30 00:00:00 +0800" itemprop="datePublished" >Oct 30, 2016</time >) </p> <span class="disqus-comment-count" data-disqus-identifier="/2016/10/30/hash-bucket/" ></span> <div class="post-categories"> Category : </div> </div> <div class="card-body" itemprop="articleBody"> <!-- <img class="card-img-top" src="https://liusida.github.io/assets/img/posts/" alt="" /> --> <p>Yesterday, I saw tf.contrib.layers.sparse_column_with_hash_bucket in a <a href="https://www.tensorflow.org/versions/r0.11/tutorials/wide/index.html">tutorial</a>. That’s a very useful function! I thought. I never met such a function in Keras or TFLearn.</p> <p>Basically, the function do something like this:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">hash</span><span class="p">(</span><span class="n">category_string</span><span class="p">)</span> <span class="o">%</span> <span class="n">dim</span>
</code></pre></div></div> <p>Let’s say the text “the quick brown fox”. If we want to put them into 5 buckets, we can get result like this:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">hash</span><span class="p">(</span><span class="n">the</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">hash</span><span class="p">(</span><span class="n">quick</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nb">hash</span><span class="p">(</span><span class="n">brown</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nb">hash</span><span class="p">(</span><span class="n">fox</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">=</span> <span class="mi">3</span>
</code></pre></div></div> <p>This example is metioned by <a href="https://www.quora.com/Can-you-explain-feature-hashing-in-an-easily-understandable-way">Luis Argerich</a></p> <p>That’s really easy for preprocessing, but there are disadvantages of that, metioned by <a href="https://www.quora.com/Can-you-explain-feature-hashing-in-an-easily-understandable-way">Artem Onuchin</a> also in that page.</p> <p>So, the common way to do this <strong>feature engineering</strong> thing is metioned by <a href="https://www.quora.com/What-are-some-best-practices-in-Feature-Engineering">Rahul Agarwal</a>:</p> <ul> <li>Scaling by Max-Min</li> <li>Normalization using Standard Deviation</li> <li>Log based feature/Target: use log based features or log based target function.</li> <li>One Hot Encoding</li> </ul> <p>Anyway, if we want to do hash_bucket without tensorflow, we can do it in Pandas which is metioned <a href="http://stackoverflow.com/questions/8673035/what-is-feature-hashing-hashing-trick/33581487">here</a>:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'state'</span><span class="p">:</span> <span class="p">[</span><span class="s">'Ohio'</span><span class="p">,</span> <span class="s">'Ohio'</span><span class="p">,</span> <span class="s">'Ohio'</span><span class="p">,</span> <span class="s">'Nevada'</span><span class="p">,</span> <span class="s">'Nevada'</span><span class="p">],</span>
        <span class="s">'year'</span><span class="p">:</span> <span class="p">[</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">2002</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">2002</span><span class="p">],</span>
        <span class="s">'pop'</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">2.9</span><span class="p">]}</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">hash_col</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="s">"_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
    <span class="k">print</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">xform</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)];</span> <span class="n">tmp</span><span class="p">[</span><span class="nb">hash</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="n">xform</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">hash_col</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">'state'</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</code></pre></div></div> <p>result:</p><pre><code class="language-code">   pop  year  state_0  state_1  state_2  state_3
0  1.5  2000        1        0        0        0
1  1.7  2001        1        0        0        0
2  3.6  2002        1        0        0        0
3  2.4  2001        1        0        0        0
4  2.9  2002        1        0        0        0
</code></pre><p><strong>[Edited]</strong> Actually, we can use <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.get_dummies.html">pandas.get_dummies</a> to do this directly:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'state'</span><span class="p">:</span> <span class="p">[</span><span class="s">'Ohio'</span><span class="p">,</span> <span class="s">'Ohio'</span><span class="p">,</span> <span class="s">'Ohio'</span><span class="p">,</span> <span class="s">'Nevada'</span><span class="p">,</span> <span class="s">'Nevada'</span><span class="p">],</span>
        <span class="s">'year'</span><span class="p">:</span> <span class="p">[</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">2002</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">2002</span><span class="p">],</span>
        <span class="s">'pop'</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">2.9</span><span class="p">]}</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'state'</span><span class="p">,</span><span class="s">'year'</span><span class="p">]))</span>
</code></pre></div></div> <p>result:</p><pre><code class="language-code">   pop  state_Nevada  state_Ohio  year_2000  year_2001  year_2002
0  1.5           0.0         1.0        1.0        0.0        0.0
1  1.7           0.0         1.0        0.0        1.0        0.0
2  3.6           0.0         1.0        0.0        0.0        1.0
3  2.4           1.0         0.0        0.0        1.0        0.0
4  2.9           1.0         0.0        0.0        0.0        1.0
</code></pre><p>After all,</p> <p>I think I should learn more about one-hot-encoding and word2vec embedding.</p> <blockquote> <p>Coming up with features is difficult, time-consuming, requires expert knowledge. “Applied machine learning” is basically feature engineering.</p> </blockquote> <p>Said <a href="http://www.andrewng.org/">Andrew Ng</a>.</p> </div><!-- Incomment incase you want to use Disqus <div id="disqus_thread"></div> --> </article> <script> var disqus_config = function () { this.page.url = "https://liusida.github.io/2016/10/30/hash-bucket/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/2016/10/30/hash-bucket"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">About Sida Liu</div> <div class="card-body"> <p class="author_bio">I am currently a M.S. graduate student in Morphology, Evolution & Cognition Laboratory at University of Vermont. I am interested in artificial intelligence, artificial life, and artificial environment.</p><!-- Place this tag where you want the button to render. --> <a class="github-button" href="https://github.com/liusida" data-size="large" data-show-count="true" aria-label="Follow @liusida on GitHub">Follow @liusida</a></div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories</div> <div class="card-body text-dark"> <div id="#Old"></div> <li class="tag-head"> <a href="/blog/categories/Old">Old</a> </li> <a name="Old"></a> <div id="#CUDA"></div> <li class="tag-head"> <a href="/blog/categories/CUDA">CUDA</a> </li> <a name="CUDA"></a> <div id="#Simulation"></div> <li class="tag-head"> <a href="/blog/categories/Simulation">Simulation</a> </li> <a name="Simulation"></a> <div id="#GPU"></div> <li class="tag-head"> <a href="/blog/categories/GPU">GPU</a> </li> <a name="GPU"></a> <div id="#Reading"></div> <li class="tag-head"> <a href="/blog/categories/Reading">Reading</a> </li> <a name="Reading"></a> <div id="#Coding"></div> <li class="tag-head"> <a href="/blog/categories/Coding">Coding</a> </li> <a name="Coding"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links</div> <div class="card-body text-dark"> <li> <a href="https://liusida.github.io/cover">Cover</a> </li> <li> <a href="https://liusida.github.io/blog">Blog</a> </li> <li> <a href="https://liusida.github.io/contact">Contact Me</a> </li> </div> </div> </div> </div> </div><footer> <p> Powered by <strong>devlopr jekyll</strong>. Subscribe via <a href=" /feed.xml ">RSS</a> </p> </footer> <script> var options = { classname: 'my-class', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <!-- <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> --> <!-- <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> --> <!-- <script src="/assets/js/mode-switcher.js"></script> --> </body> </html>
