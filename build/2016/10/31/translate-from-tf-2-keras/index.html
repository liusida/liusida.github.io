<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8"> <title>from Tensorflow to Keras</title> <meta http-equip="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content="from Tensorflow to Keras" /> <meta name="keywords" content="from Tensorflow to Keras, Sida Liu, " /> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"> <meta content="" property="fb:app_id"> <meta content="Sida Liu" property="og:site_name"> <meta content="from Tensorflow to Keras" property="og:title"> <meta content="article" property="og:type"> <meta content="The world is so complex that we cannot stop learning." property="og:description"> <meta content="http://172.25.168.122:4000/2016/10/31/translate-from-tf-2-keras/" property="og:url"> <meta content="2016-10-31T00:00:00+08:00" property="article:published_time"> <meta content="http://172.25.168.122:4000/about/" property="article:author"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@"> <meta name="twitter:title" content="from Tensorflow to Keras"> <meta content="Sida Liu" property="og:site_name"> <meta name="twitter:url" content="http://172.25.168.122:4000/2016/10/31/translate-from-tf-2-keras/"> <meta name="twitter:description" content="The world is so complex that we cannot stop learning."> <link rel="stylesheet" href="/assets/css/main.css" /> <!-- <link rel="stylesheet" href="/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="/assets/bower_components/lightgallery/dist/css/lightgallery.min.css"/> <!-- <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css" /> --> <!-- <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css"> --> <!-- <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css"> --> <link rel="stylesheet" href="/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="/assets/bower_components/icono/dist/icono.min.css"/> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet"> <!-- Favicon --> <link rel="icon" href="http://172.25.168.122:4000/assets/img/favicon.ico" type="image/gif" sizes="16x16"> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous"></script> <!-- <script src="/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <!-- <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script> --> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script> </head><body> <nav class="navbar navbar-expand-lg fixed-top navbar-dark" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/">Sida Liu</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="http://172.25.168.122:4000/cover" >Cover</a > </li> <li class="nav-item"> <a class="nav-link" href="http://172.25.168.122:4000/blog" >Blog</a > </li> <li class="nav-item"> <a class="nav-link" href="http://172.25.168.122:4000/contact" >Contact Me</a > </li> </ul> </div> <ul class="nav justify-content-end"> <!-- <li class="nav-item"> <a class="nav-link" id="search-icon" href="http://172.25.168.122:4000/search#/" ><i class="fa fa-search" aria-hidden="true"></i ></a> </li> <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() " type="checkbox" name="checkbox" /> </li> --> </ul> </nav> <div class="col-lg-12"> <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script> <div class="row" id="blog-post-container"> <div class="col-lg-8 offset-md-2"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">from Tensorflow to Keras</h1> <h4 class="post-meta"></h4> <p class="post-summary"> Posted by : (<time datetime="2016-10-31 00:00:00 +0800" itemprop="datePublished" >Oct 31, 2016</time >) </p> <span class="disqus-comment-count" data-disqus-identifier="/2016/10/31/translate-from-tf-2-keras/" ></span> <div class="post-categories"> Category : </div> </div> <div class="card-body" itemprop="articleBody"> <!-- <img class="card-img-top" src="http://172.25.168.122:4000/assets/img/posts/" alt="" /> --> <p>I know 3 high level api for deep learning. They are Tensorflow.contrib.learn(SKFlow), TFLearn and Keras. All of them are great tools, but maybe I like Keras because of the easy style of code.</p> <p>When I came through the <a href="https://www.tensorflow.org/versions/r0.11/tutorials/wide_and_deep/index.html">Tensorflow Tutorial of Deep and Wide Learning</a>, I felt I can translate the code from tf.contrib.learn into Keras.</p> <p><img src="https://www.tensorflow.org/versions/r0.11/images/wide_n_deep.svg" alt="Tensorflow Wide and Deep Learning" /></p> <p>In Tensorflow’s tutorial, they said that, using Wide&amp;Deep Model together, they could improve the accuracy from 83.6% to about 84.4%. After my Keras code was finished, I found that the accuracy of my new model is more than 85%. Although I used more units in the model, that’s still nice I think!~</p> <p>The dataset can be download here: <a href="https://archive.ics.uci.edu/ml/machine-learning-databases/adult/adult.data">train_dataset</a> and <a href="https://archive.ics.uci.edu/ml/machine-learning-databases/adult/adult.test">test_dataset</a></p> <p>Here is my code for Keras:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="n">COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s">"age"</span><span class="p">,</span> <span class="s">"workclass"</span><span class="p">,</span> <span class="s">"fnlwgt"</span><span class="p">,</span> <span class="s">"education"</span><span class="p">,</span> <span class="s">"education_num"</span><span class="p">,</span>
           <span class="s">"marital_status"</span><span class="p">,</span> <span class="s">"occupation"</span><span class="p">,</span> <span class="s">"relationship"</span><span class="p">,</span> <span class="s">"race"</span><span class="p">,</span> <span class="s">"gender"</span><span class="p">,</span>
           <span class="s">"capital_gain"</span><span class="p">,</span> <span class="s">"capital_loss"</span><span class="p">,</span> <span class="s">"hours_per_week"</span><span class="p">,</span> <span class="s">"native_country"</span><span class="p">,</span>
           <span class="s">"income_bracket"</span><span class="p">]</span>
<span class="n">LABEL_COLUMN</span> <span class="o">=</span> <span class="s">"label"</span>
<span class="n">CATEGORICAL_COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s">"workclass"</span><span class="p">,</span> <span class="s">"education"</span><span class="p">,</span> <span class="s">"marital_status"</span><span class="p">,</span> <span class="s">"occupation"</span><span class="p">,</span>
                       <span class="s">"relationship"</span><span class="p">,</span> <span class="s">"race"</span><span class="p">,</span> <span class="s">"gender"</span><span class="p">,</span> <span class="s">"native_country"</span><span class="p">]</span>
<span class="n">CONTINUOUS_COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s">"age"</span><span class="p">,</span> <span class="s">"education_num"</span><span class="p">,</span> <span class="s">"capital_gain"</span><span class="p">,</span> <span class="s">"capital_loss"</span><span class="p">,</span>
                      <span class="s">"hours_per_week"</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">load_df</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
		<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">COLUMNS</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s">'python'</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
	<span class="n">df</span><span class="p">[</span><span class="n">LABEL_COLUMN</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'income_bracket'</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">"&gt;50K"</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)).</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
	<span class="n">df</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="s">"income_bracket"</span><span class="p">)</span>
	<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">LABEL_COLUMN</span><span class="p">].</span><span class="n">values</span>
	<span class="n">df</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="n">LABEL_COLUMN</span><span class="p">)</span>

	<span class="c1"># This makes One-Hot Encoding:
</span>	<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">CATEGORICAL_COLUMNS</span><span class="p">])</span>
	<span class="c1"># This makes scaled:
</span>	<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">().</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span>

	<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">values</span>
	<span class="k">return</span> <span class="n">X</span><span class="p">,</span><span class="n">y</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
	<span class="n">df_train</span> <span class="o">=</span> <span class="n">load_df</span><span class="p">(</span><span class="s">'data/traindata'</span><span class="p">)</span>
	<span class="n">df_test</span> <span class="o">=</span> <span class="n">load_df</span><span class="p">(</span><span class="s">'data/testdata'</span><span class="p">)</span>
	<span class="n">train_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_train</span><span class="p">)</span>
	<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_train</span><span class="p">,</span> <span class="n">df_test</span><span class="p">])</span>
	<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
	<span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">train_len</span><span class="p">]</span>
	<span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">train_len</span><span class="p">]</span>
	<span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">train_len</span><span class="p">:]</span>
	<span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">train_len</span><span class="p">:]</span>

	<span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
	<span class="n">model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="n">input_dim</span><span class="o">=</span><span class="n">X_train</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">))</span>
	<span class="n">model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1024</span><span class="p">))</span>
	<span class="n">model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'sigmoid'</span><span class="p">))</span>
	<span class="n">model</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s">'rmsprop'</span><span class="p">,</span>
					<span class="n">loss</span><span class="o">=</span><span class="s">'binary_crossentropy'</span><span class="p">,</span>
					<span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s">'accuracy'</span><span class="p">])</span>

	<span class="n">model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">nb_epoch</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span> <span class="p">)</span>
	<span class="n">loss</span><span class="p">,</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
	<span class="k">print</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
	<span class="k">print</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)</span>

<span class="k">if</span> <span class="p">(</span><span class="n">__name__</span><span class="o">==</span><span class="s">'__main__'</span><span class="p">):</span>
	<span class="n">main</span><span class="p">()</span>
</code></pre></div></div> <p>During coding, I found preprocessing is very important:</p> <ul> <li>By using <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.get_dummies.html">One-Hot Encoding</a>, I even don’t need to treat Wide and Deep model separately. I just one-hot encode the categorical columns, and they can be feed together with continuous columns.</li> <li>By using <a href="http://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html">MaxMinScaler</a>, I can avoid the result goes to one side at all. For example, if I don’t use scaler, my prediction should be all 0s or 1s, because some columns have very big numbers, the model will ignore other columns’ effect.</li> </ul> <p>And thanks to sklearn and pandas, Keras don’t need to do those preprocessing at all, which Tensorflow is doing these staff inside the model. I think it’s better to do that before we feed the data, so it will be much clear what we are feeding to the neural network.</p> Any feedback? Please at me on <a class="social-link" href="http://twitter.com/liusida2007" > <i class="fab fa-twitter"></i> </a> </div><!-- Incomment incase you want to use Disqus <div id="disqus_thread"></div> --> </article> <script> var disqus_config = function () { this.page.url = "http://172.25.168.122:4000/2016/10/31/translate-from-tf-2-keras/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/2016/10/31/translate-from-tf-2-keras"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">About Sida Liu</div> <div class="card-body"> <p class="author_bio">I am currently a M.S. graduate student in Morphology, Evolution & Cognition Laboratory at University of Vermont. I am interested in artificial intelligence, artificial life, and artificial environment.</p><!-- Place this tag where you want the button to render. --> <a class="github-button" href="https://github.com/liusida" data-size="large" data-show-count="true" aria-label="Follow @liusida on GitHub">Follow @liusida</a></div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories</div> <div class="card-body text-dark"> <div id="#Old"></div> <li class="tag-head"> <a href="/blog/categories/Old">Old</a> </li> <a name="Old"></a> <div id="#CUDA"></div> <li class="tag-head"> <a href="/blog/categories/CUDA">CUDA</a> </li> <a name="CUDA"></a> <div id="#Simulation"></div> <li class="tag-head"> <a href="/blog/categories/Simulation">Simulation</a> </li> <a name="Simulation"></a> <div id="#GPU"></div> <li class="tag-head"> <a href="/blog/categories/GPU">GPU</a> </li> <a name="GPU"></a> <div id="#Reading"></div> <li class="tag-head"> <a href="/blog/categories/Reading">Reading</a> </li> <a name="Reading"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links</div> <div class="card-body text-dark"> <li> <a href="http://172.25.168.122:4000/cover">Cover</a> </li> <li> <a href="http://172.25.168.122:4000/blog">Blog</a> </li> <li> <a href="http://172.25.168.122:4000/contact">Contact Me</a> </li> </div> </div> </div> </div> </div><footer> <p> Powered by <strong>devlopr jekyll</strong>. Subscribe via <a href=" /feed.xml ">RSS</a> </p> </footer> <script> var options = { classname: 'my-class', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <!-- <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> --> <!-- <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> --> <!-- <script src="/assets/js/mode-switcher.js"></script> --> </body> </html>
